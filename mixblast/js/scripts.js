function checkAuth(){gapi.auth.authorize({client_id:OAUTH2_CLIENT_ID,scope:OAUTH2_SCOPES,immediate:!0},handleAuthResult)}function handleAuthResult(t){t&&!t.error?($(".pre-auth").hide(),$(".post-auth").show(),loadAPIClientInterfaces()):($(".pre-auth").css("display","block !important"),$(".pre-auth").show(),gapi.client.load("youtube","v3",handleAPILoaded),$("#login-link").click(function(){gapi.auth.authorize({client_id:OAUTH2_CLIENT_ID,scope:OAUTH2_SCOPES,immediate:!1},handleAuthResult)}))}function loadAPIClientInterfaces(){gapi.client.load("youtube","v3",function(){handleAPILoaded()})}if("localhost"==document.location.hostname)var OAUTH2_CLIENT_ID="1069965346841-omq120306nl685roud6bvdut0dnka460.apps.googleusercontent.com";else var OAUTH2_CLIENT_ID="1069965346841-uggqc6vqcna4j32gfncdbaaq39elcc02.apps.googleusercontent.com";var OAUTH2_SCOPES=["https://www.googleapis.com/auth/youtube"];googleApiClientReady=function(){gapi.auth.init(function(){window.setTimeout(checkAuth,1)})};
function multiSearch(){editSearchTerm(0),search.vidObjArray={},search.topvIdArray=[],search.topvTitleArray=[],search.topvThumbArray=[],search.listArray=[],search.vidcount=0,search.playcount=0,search.done=!1,search.count||(search.count=0),$("#player-container").show(),$("#button-container").show(),$("#search-container").empty(),$("#errormsg").hide(),$("#advanced-container").hide(),$("#youtube-playlist-container").show(),$("#player-thumb-close").show(),$("#mixbuilder-buttons").show(),search.topvIdArray&&(search.topvIdArray.length=0,search.topvTitleArray.length=0,search.topvThumbArray.length=0,search.listArray.length=0),pastBlasts.add($("#query").val());for(var t=$("#query").val().split(/\n/),e=0;e<t.length;e++)/\S/.test(t[e])&&search.listArray.push($.trim(t[e]));var r=0,i=search.listArray.length;if(1>i){$("#errormsg-txt").html("Error. <br>No songs. Put a list of songs into the textbox.");setTimeout(function(){$("#editplaylist").trigger("click")},1e3);return $("#errormsg").show(),!1}!function a(){search.listArray[r]&&search(search.listArray[r],r),r++;var t=600,e=setTimeout(a,t);r==i&&($("#playlist-button").attr("disabled",!1),$("#shufflebutton").removeClass("disabled"),search.done=!0,clearTimeout(e))}(),search.count++}function allSongsBy(t,e){if(!e)var e=$("#topSongs-num").val();$.getJSON("https://ws.audioscrobbler.com/2.0/?method=artist.gettoptracks&artist="+t+"&autocorrect=1&api_key=946a0b231980d52f90b8a31e15bccb16&limit="+e+"&format=json&callback=?",function(e){if(!r)var r="";if(void 0!=e.toptracks&&void 0!=e.toptracks.track){$.each(e.toptracks.track,function(e,i){r+=t+" - "+i.name+"\n"}),void 0===search.count?($("#query").val(r),search.count=0):$("#query").val($("#query").val()+r);var i=document.getElementById("query");setTimeout(function(){i.scrollTop=i.scrollHeight},1e3)}else $("#errormsg").show(),$("#errormsg-txt").html(": ( <br><br>Error loading videos by: "+t+"<br><br>Check spelling?")})}function dropdownSwitcher(){"drop-similarSongs"==search.dropVal?($("#mixbuilder-artist").show().css("width","45%"),$("#mixbuilder-song").show().css("width","45%"),$("#mixbuilder-album").hide(),$("#songNum").css("display","inline-block")):"drop-album"==search.dropVal?($("#mixbuilder-artist").show().css("width","45%"),$("#mixbuilder-song").hide(),$("#mixbuilder-album").show().css("width","45%")):"drop-paste"==search.dropVal?(editTextList(),$("#mixbuilder-artist").hide(),$("#mixbuilder-song").hide(),$("#mixbuilder-album").hide()):($("#mixbuilder-artist").show().css("width","95%"),$("#mixbuilder-song").hide(),$("#mixbuilder-album").hide(),$("#songNum").css("display","inline-block")),console.log(search.dropVal),"drop-quickMix"==search.dropVal||"drop-topAlbums"==search.dropVal||"drop-album"==search.dropVal?($("#songNum").hide(),$(document).width()<992&&$("#mixbuilder-dropdown").css("margin-left","0px")):($("#songNum").show(),$(document).width()<992&&$("#mixbuilder-dropdown").css("margin-left","60px")),localStorage.setItem("dropdown-lastvalue",search.dropVal)}function editSearchTerm(){var t=$("#editplaylist").html(),e="205px",r="85px";if($(document).width()<992){e="40px";var r="127px"}t.indexOf("Edit Playlist")>-1?($("#player-container").css({top:"0px",right:"0px",width:"160px",height:"87px"}),$("#query").animate({height:"345px"},"fast",function(){$("#related-container").show(),$("#related-more").show()}),$("#player-thumb-close").show(),$("#mixbuilder-bar").show(),$("#mixbuilder-buttons").show(),$("#editplaylist").html(t.replace("Edit Playlist","Close Playlist Editor"))):($("#related-container").hide(),$("#related-more").hide(),$("#query").show(),$("#player-container").css({top:r,right:"0px",width:"100%",height:"364px"},function(){$("#mixbuilder-bar").hide()}),$("#query").animate({height:e},"fast"),$("#player-thumb-close").hide(),$("#mixbuilder-buttons").show(),$("#editplaylist").html(t.replace("Close Playlist Editor","Edit Playlist")))}var search=function(t,e){var r=t,i=e,a=gapi.client.youtube.search.list({q:r,part:"snippet",maxResults:20});a.execute(function(t){var e=t.result,r=[],a=[],o=[];e||console.log("bad search: "+i),$.each(e.items,function(t,e){var s=e.id.videoId,l=e.snippet.title;if(void 0!=e.snippet.thumbnails["default"].url)var n=e.snippet.thumbnails["default"].url;void 0===s&&(s="Not Found",l="Not Found. Try version refresh button: ",n="img/notfound.png"),r.push(s),a.push(l),o.push(n),search.vidObjArray[i]={vid:r,title:a,thumb:o},0===t&&(search.topvIdArray.push(s),search.topvTitleArray.push(l),search.topvThumbArray.push(n),1==search.topvIdArray.length&&1==search.count&&loadVid(search.topvIdArray[0],0,"medium"),renderPlaylist(i,n,s,l),i++)})})},mixBuilder={render:function(t,e,r){var i=$("#topSongs-num").val();"drop-topSongs"==search.dropVal?mixBuilder.getJSON("https://ws.audioscrobbler.com/2.0/?method=artist.gettoptracks&artist="+t+"&autocorrect=1&api_key=946a0b231980d52f90b8a31e15bccb16&limit="+i+"&format=json&callback=?",t,e,r):"drop-similarSongs"==search.dropVal?mixBuilder.getJSON("https://ws.audioscrobbler.com/2.0/?method=track.getsimilar&artist="+t+"&track="+e+"&api_key=946a0b231980d52f90b8a31e15bccb16&limit="+i+"&format=json&callback=?",t,e,r):"drop-topAlbums"==search.dropVal?mixBuilder.getJSON("https://ws.audioscrobbler.com/2.0/?method=artist.gettopalbums&artist="+t+"&api_key=946a0b231980d52f90b8a31e15bccb16&limit=100&format=json&callback=?",t,e):"drop-album"==search.dropVal?mixBuilder.getJSON("https://ws.audioscrobbler.com/2.0/?method=album.getinfo&artist="+t+"&album="+r+"&api_key=946a0b231980d52f90b8a31e15bccb16&limit="+i+"&format=json&callback=?",t,e,r):"drop-quickMix"==search.dropVal?(mixBuilder.getJSON("https://developer.echonest.com/api/v4/playlist/static?api_key=KHXHOPL1UHQ0LU1ES&artist="+t+"&type=artist-radio&results=100",t,e),console.log("https://developer.echonest.com/api/v4/playlist/static?api_key=KHXHOPL1UHQ0LU1ES&artist="+t+"&type=artist-radio&results=100")):(console.log("dropdown not selected"),mixBuilder.getJSON("https://ws.audioscrobbler.com/2.0/?method=artist.gettoptracks&artist="+t+"&autocorrect=1&api_key=946a0b231980d52f90b8a31e15bccb16&limit=100&format=json&callback=?",t,e,r)),showRelated.artists(t)},search:function(){"drop-similarSongs"==search.dropVal?mixBuilder.render($.trim($("#mixbuilder-artist").val()),$.trim($("#mixbuilder-song").val()),""):"drop-album"==search.dropVal?mixBuilder.render($.trim($("#mixbuilder-artist").val()),"",$.trim($("#mixbuilder-album").val())):mixBuilder.render($.trim($("#mixbuilder-artist").val()),"","")},getJSON:function(t,e,r){$.getJSON(t,function(t){mixBuilder.songlist="",void 0!=t.toptracks&&void 0!=t.toptracks.track?$.each(t.toptracks.track,function(t,r){mixBuilder.songlist+=e+" - "+r.name+"\n"}):void 0!=t.similartracks?(mixBuilder.songlist=e+" - "+r+"\n",$.each(t.similartracks.track,function(t,e){mixBuilder.songlist+=e.artist.name+" - "+e.name+"\n"})):void 0!=t.topalbums?(mixBuilder.songlist="",$.each(t.topalbums.album,function(t,r){mixBuilder.songlist+=e+" - "+r.name+" - full\n"})):void 0!=t.album?(mixBuilder.songlist="",$.each(t.album.tracks.track,function(t,e){mixBuilder.songlist+=e.artist.name+" - "+e.name+"\n"})):void 0!=t.response?$.each(t.response.songs,function(t,e){mixBuilder.songlist+=e.artist_name+" - "+e.title+"\n"}):($("#errormsg").show(),$("#errormsg-txt").html(": ( <br><br>Error loading videos for: "+e+"<br><br>Check spelling?"))}).done(function(){}).fail(function(){console.log("error"),$("#errormsg").show(),$("#errormsg-text").html(t+" : (() <br><br>Error loading videos for: "+e+"<br><br>Check spelling?")}).always(function(){if(void 0===search.count)$("#query").val(mixBuilder.songlist),search.count=0;else if(""==$.trim($("#query").val()))$("#query").val(mixBuilder.songlist);else{$("#query").val($("#query").val()+mixBuilder.songlist);var t=document.getElementById("query");setTimeout(function(){t.scrollTop=t.scrollHeight},1e3)}})}};$(".dropdown-menu li").click(function(t){var e=$(t.currentTarget);return search.dropVal=this.id,dropdownSwitcher(),e.closest(".btn-group").find('[data-bind="label"]').html(e.html()).end().children(".dropdown-toggle").dropdown("toggle"),!1}),$("#topSongs-num, #mixbuilder-artist, #mixbuilder-song, #mixbuilder-album").keypress(function(t){var e=t.which;13==e&&(mixBuilder.search(),$("#ui-id-1").hide())}),$("#mixbuilder-artist, #mixbuilder-song, #mixbuilder-album").click(function(){$(this).select(),this.setSelectionRange(0,9999)}),$("#mixbuilder-search-button").click(function(){mixBuilder.search()});var showRelated={artists:function(t){$("#related-container").show();var e;e=" Songs By A Related Artist:",$.getJSON("https://ws.audioscrobbler.com/2.0/?method=artist.getsimilar&artist="+t+"&limit=60&autocorrect=1&api_key=946a0b231980d52f90b8a31e15bccb16&format=json",function(r){var i,a="";r.similarartists?($.each(r.similarartists.artist,function(t,e){e.name?i=e.name.replace(/["']/g,"\\'"):console.log("related artist error"),a+='<a class="similar-artistButton" href="javascript:void(0);" onclick="showRelated.addSongs(\''+i+"')\">"+e.name+"</a>",t<r.similarartists.artist.length-1&&(a+=" ")}),$("#related-container").html("<br><hr class='similar-top'><span id='similarArtTitle'>Add <input id='similar-num' value='10' type='number' pattern='[0-9]*'' inputmode='numeric'></span><span id='addString'>"+e+"</span></span>&nbsp;"+a)):$("#related-container").html("<br><hr class='similar-top'>Error loading related artists: "+t)}),$("#related-more").show()},addSongs:function(t){return $("#mixbuilder-artist").val(t),allSongsBy(t,$("#similar-num").val()),!1}};$("#related-more").click(function(){"..."==$("#related-more").text()?($("#related-container").css({height:"auto"}),$("#related-more").text("Less...")):($("#related-container").css({height:"134px"}),$("#related-more").text("..."))}),$("#shuffletext").click(function(){var t=$("#query").val().split("\n");shuffle(t);for(var e="",r=0;r<t.length;r++)/\S/.test(t[r])&&(e+=t[r]+"\n");$("#query").val(e)}),$("#query-clear").click(function(){$("#query").val("")}),$("#editplaylist").click(function(){editSearchTerm(0)}),$("#player-thumb-close").click(function(){editSearchTerm(0)}),$("#closeAdvanced").click(function(){$("#advanced-container").slideToggle("fast")}),$(document).keydown(function(t){if(!$("input,textarea").is(":focus"))switch(t.which){case 37:nextVideo(!1);break;case 192:return void editSearchTerm(0);case 39:nextVideo(!0);break;case 32:playPause(),t.preventDefault();break;default:return}});
function handleAPILoaded(){gapi.client.setApiKey("AIzaSyDlcHPnr5gJr1_pBSvVSRtFudfpIUppfjM"),$("#playlist-button").html("Save a Playlist"),$("#search-button").attr("disabled",!1),onYouTubeIframeAPIReady_renamed()}function onPlayerReady(){$("#prevbutton").click(function(){nextVideo(!1)}),$("#playpause").click(function(){playPause()}),$("#nextbutton").click(function(){nextVideo(!0)}),$("#shufflebutton").click(function(){return $("#shufflebutton").hasClass("disabled")?!1:void shuffleIt()}),$("#search-button").html('Blast a Mix <img src="img/play-arrow.svg" id="play-arrow-icon">')}function onYouTubeIframeAPIReady_renamed(){player=new YT.Player("player",{height:"394",width:"700",events:{onReady:onPlayerReady,onError:onPlayerError,onStateChange:onPlayerStateChange},playerVars:{modestbranding:1,enablejsapi:1,iv_load_policy:3,theme:"dark",color:"white",showinfo:1,playsinline:1}})}function onPlayerError(t){$("#errormsg-txt").html("Whoops. Error: "+t.data+" (Unknown error, try refreshing page with ctrl + shift + r"),150==t.data?(wrongSong(),$("#errormsg-txt").hide()):(nextVideo(!0),$("#errormsg-txt").hide())}function onPlayerStateChange(t){if(1!=t.data?$("#playpb").attr("src","img/media_play.svg"):$("#playpb").attr("src","img/media_pause.svg"),0===t.data){var e=search.topvIdArray.length;search.playcount+1<e?nextVideo(!0):search.playcount=-1}}function renderPlaylist(t,e,a,r){$("#search-container").append("<div class='searchresult'>"+createPlaylistItem(t,e,a,r)+"</div>")}function createPlaylistItem(t,e,a,r,i){var s='loadVid("'+a+'"); search.vidcount='+t+";",l="";return"Not Found"==a&&(s="editSearchTerm(0);",l="<input id='not-found' value='"+search.listArray[t]+"'> "),void 0===i&&(i=0),"<div class='searchresult-div'><img id='thumb' src='"+e+"'></div> <div class='searchresult-title'>"+l+"<a id='link' onclick='"+s+"' title='"+r+"'>"+r+"</a></div><div id='searchresult-refresh'><img src='img/refresh-icon.svg' data-toggle='tooltip' title='Version Swap \n("+search.listArray[t]+")' class='refreshb' id='"+t+"'><input id='swapcount' type='hidden' value="+i+"></div>"}function playPause(){1!=player.getPlayerState()?(player.playVideo(),$("#playpb").attr("src","img/media_pause.svg")):(player.pauseVideo(),$("#playpb").attr("src","img/media_play.svg"))}function nextVideo(t){var e=search.topvIdArray.length;t===!0?(search.vidcount++,search.playcount++,search.vidcount>=e&&(search.vidcount=0),$("#search-container").append($("#search-container div.searchresult:first"))):(search.vidcount--,search.playcount--,(search.vidcount<0||"undefined"==search.vidcount)&&(search.vidcount=e-1),$("#search-container").prepend($("#search-container div.searchresult:last"))),swapper=1;var a=search.topvIdArray[search.vidcount];a&&loadVid(a)}function loadVid(t){add();player.loadVideoById?(player.loadVideoById(t),search.topvTitleArray[search.vidcount]&&(document.title=search.topvTitleArray[search.vidcount]+" - Mixblast"),$("#favicon").attr("href",search.topvThumbArray[search.vidcount])):$("#errormsg-txt").html("Whoops. Youtube API error, try refreshing page with ctrl + shift + r")}function cuePlayer(){add();player.cueVideoById?player.cueVideoById(search.topvIdArray[0]):(console.log(player),console.log(player.cueVideoById))}function shuffleIt(){$("#search-container").empty(),search.count>1&&(search.vidcount=0);for(var t=search.topvIdArray.length,e=[],a=0;t>a;a++)e.push(a);var r=shuffle(e);$.isEmptyObject(search.prev_vidObjArray)&&(search.prev_vidObjArray=jQuery.extend(!0,{},search.vidObjArray)),search.topvIdArray.length=0,search.topvTitleArray.length=0,search.topvThumbArray.length=0;for(var i=0;t>i;i++){var s,l,o,n=r[i];search.prev_vidObjArray[n]?(s=search.prev_vidObjArray[n].vid[0],l=search.prev_vidObjArray[n].title[0],o=search.prev_vidObjArray[n].thumb[0]):(s="Not Found",l="Not Found.",o="img/notfound.png"),search.topvIdArray.push(s),search.topvTitleArray.push(l),search.topvThumbArray.push(o),renderPlaylist(i,o,s,l);for(var c=0;c<search.prev_vidObjArray[0].vid.length;c++)search.vidObjArray[i]={vid:search.prev_vidObjArray[n].vid,title:search.prev_vidObjArray[n].title,thumb:search.prev_vidObjArray[n].thumb}}}function shuffle(t){for(var e,a,r=t.length;r;e=Math.floor(Math.random()*r),a=t[--r],t[r]=t[e],t[e]=a);return t}function wrongSong(){swapper>19&&(swapper=0),loadVid(search.vidObjArray[search.vidcount].vid[swapper]),swapper++}var tag=document.createElement("script");tag.src="https://www.youtube.com/iframe_api";var firstScriptTag=document.getElementsByTagName("script")[0];firstScriptTag.parentNode.insertBefore(tag,firstScriptTag);var player;$("#wrongsong").click(function(){wrongSong()});var swapper=1;$("#search-container").on("click contextmenu",".refreshb",function(t){var e=this.id,a=$(this).nextAll("#swapcount").val();2==t.button?(a--,t.preventDefault()):a++;var r=search.vidObjArray[e].vid.length;a>=r&&(a=0),0>a&&(a=r-1);var i=search.vidObjArray[e].vid[a],s="loadVid('"+i+"'); search.vidcount="+e;("Not Found"===i||void 0===i)&&(s="editSearchTerm("+e+");");var l=search.vidObjArray[e].thumb[a],o=search.vidObjArray[e].title[a];$(this).parent().parent().html(createPlaylistItem(e,l,i,o,a));var n=search.topvIdArray.indexOf(search.topvIdArray[e]);-1!==n&&(search.topvIdArray[n]=i),$(this).nextAll("#swapcount").val(a)}),$("#pb-menu").on("click",".pb-module",function(){$("#query").show(),$("#text-container").show(),$("#player-container").hide();for(var t=pastBlasts.list(),e=0;e<t.length;e++)if(/\S/.test(t[e]))for(var a=t[e].split("\n"),r=0,i=a.length;i>r;r++)if(0===r&&a[r]==this.id){var s=$.trim(pastBlasts.allBlasts[e]),l=s.split("\n");l=l,l.shift(),s=l.join("\n"),$("#query").val(s)}}),$("#pb-menu").on("click",".pb-delete",function(t){pastBlasts["delete"](this.id),t.stopPropagation()});var infoBlast={display:function(){$("#pb-menu").animate({left:"-400px"},"fast"),$("#info-menu").animate({left:"0px"},"fast")},hide:function(){$("#pb-menu").animate({left:"-400px"},"fast"),$("#info-menu").animate({left:"-400px"},"fast")}},pastBlasts={needsUpdate:!0,list:function(){return pastBlasts.allBlasts?pastBlasts.allBlasts_len!=pastBlasts.allBlasts.length?(pastBlasts.allBlasts_len=pastBlasts.allBlasts.length,pastBlasts.needsUpdate=!1):pastBlasts.needsUpdate=!1:(pastBlasts.needsUpdate=!0,pastBlasts.allBlasts=JSON.parse(localStorage.getItem("pastBlasts")),null==pastBlasts.allBlasts&&(pastBlasts.allBlasts=[]),pastBlasts.allBlasts_len=pastBlasts.allBlasts.length),pastBlasts.allBlasts.sort().reverse()},display:function(){if(pastBlasts.needsUpdate){var t=pastBlasts.list();if(t.length<=0){var e=new Date;t=[e.toJSON()+"\n No History Yet. \n Playlists are auto-saved when you Blast a Mix."]}$("#pb-menu").html('<div id="pb-button"><img class="pb-button-big" src="img/past-blasts-icon.svg"> <span id="pb-text"></span></div>');for(var a=0,r=t.length;r>a;a++){for(var i=t[a].split("\n"),s="",l="",o="",n=0,c=4;c>n;n++){if(0===n){o=i[n];var d=i[n].split(/[-T:.]/);l=new Date(d[0]+"/"+d[1]+"/"+d[2]+" "+d[3]+":"+d[4]+":"+d[5]+" UTC");var u={weekday:"long",year:"numeric",month:"short",day:"numeric",hour:"2-digit",minute:"2-digit"},h=l.toLocaleTimeString("en-us",u);i[n]='<span id="pb-date">'+h+"</span>"}i[n]&&(s+=i[n]+"<br>")}$("#pb-menu").append('<div class="pb-wrapper"><div class="pb-module line-clamp" id="'+o+'">'+s+'</div><a class="pb-delete" id="'+o+'" title="Delete"> &#9940; </a></div>')}}$("#pb-menu").show(),$("#pb-text").html("Recent History"),$("#pb-menu").animate({left:"0px"},"fast"),$("#info-menu").animate({left:"-400px"},"fast")},hide:function(){$("#pb-menu").animate({left:"-400px"},"fast",function(){$("#pb-menu").hide()}),$("#pb-text").html("")},add:function(t){var e=pastBlasts.list();if(e.length>0)var a=e[0].split("\n").slice(1).join("\n");else{e=[];var a=""}if($.trim(a)!=$.trim(t)){var r=new Date;e.push(r.toJSON()+"\n"+t+"\n"),localStorage.setItem("pastBlasts",JSON.stringify(e)),pastBlasts.needsUpdate=!0}},"delete":function(t){for(var e=pastBlasts.list(),a=0;a<e.length;a++)if(/\S/.test(e[a]))for(var r=e[a].split("\n"),i=0,s=r.length;s>i;i++)0===i&&r[i]==t&&(e.splice(a,1),console.log("deleting:"+r[i]));localStorage.setItem("pastBlasts",JSON.stringify(e)),pastBlasts.needsUpdate=!0,pastBlasts.display()}};$(document).ready(function(){$("body").click(function(){pastBlasts.hide(),infoBlast.hide()}),$("#errormsg, #query").click(function(){$("#errormsg").hide()});var t=localStorage.getItem("mixfile"),e=JSON.parse(t);e&&""!=e&&$("#query").val(e);var a=localStorage.getItem("how_many_songs");isNaN($.trim(a))&&(a=40),null===a&&(a=40),$("#topSongs-num").val(a),$("#topSongs-num").blur(function(){how_many_songs=$("#topSongs-num").val(),localStorage.setItem("how_many_songs",how_many_songs)});var r=localStorage.getItem("dropdown-lastvalue");null!=r&&(search.dropVal=r,$("#mixbuilder-dropdown > button > span:nth-child(1)").text($("#"+r).text()),dropdownSwitcher());var i=localStorage.getItem("artist");$("#mixbuilder-artist").val(i),$("#mixbuilder-artist").blur(function(){artist=$("#mixbuilder-artist").val(),localStorage.setItem("artist",artist)});var s=localStorage.getItem("album");$("#mixbuilder-album").val(s),$("#mixbuilder-album").blur(function(){album=$("#mixbuilder-album").val(),localStorage.setItem("album",album)});var l=localStorage.getItem("last_similarArtist");$("#mixbuilder-artist").val(l),$("#mixbuilder-artist").blur(function(){l=$("#mixbuilder-artist").val(),localStorage.setItem("last_similarArtist",l)});var o=localStorage.getItem("last_similarSong");$("#mixbuilder-song").val(o),$("#mixbuilder-song").blur(function(){o=$("#mixbuilder-song").val(),localStorage.setItem("last_similarSong",o)}),$("#mixbuilder-artist").focus(),$("#mixbuilder-artist").select(),$("#search-button").click(function(){multiSearch(),$("#shufflebutton").addClass("disabled"),mixfile=$("#query").val(),localStorage.setItem("mixfile",JSON.stringify(mixfile))}),$("#playlist-button").click(function(){createPlaylist()}),$("#playlist-url").hide(),"ontouchstart"in window||$('[data-toggle="tooltip"]').tooltip(),$("#search-container").sortable({placeholder:"ui-state-highlight",update:function(){var t=$("#search-container").sortable("serialize",{key:"sort"});console.log(t)}}),$("#search-container").disableSelection();var n="mixblaster.webmaster@gmail.com";$("#emailme").append("<a href='mailto:"+n+"' target='_blank'>"+n+"</a>")});
function editTextList(){$("#mixbuilder-buttons").show(),$("#query").show(),$("#query2").val($("#query").val()),$("#related-container").hide(),$("#related-more").hide(),$("#mixbuilder-search-button").show()}function addArtist(){var e=$("#query2"),t=e.val().split("\n"),a=[];$.each(t,function(e,t){a.push(newartist.val()+$.trim(t))});var r=a.join("\n");$("#query").val(r)}function removeNumbas(){var e=$("#query").val();if($("input#removenums").is(":checked")){prevtext_state=e;var t=e.split(/\n/);e="";for(var a=0;a<t.length;a++)/\S/.test(t[a])&&(e+=t[a].replace(/^\d+\s*[-\\.)#]?\s+/,"")+"\n");$("#query").val(e)}else $("#query").val(prevtext_state)}function removeParentheticals(){var e=$("#query").val();if($("input#removeparenths").is(":checked")){prevtext_state=e,e=e.replace(/ *\([^)]*\) */g," "),e=e.replace(/\[.*?\]/g," ");for(var t=e.split(/\n/),a=0;a<t.length;a++)/\S/.test(t[a])&&$("#query").val(e)}else $("#query").val(prevtext_state)}function magicSongExtractor(){}function readMultipleFiles(e){var t=e.target.files;if(t)for(var a,r=0;a=t[r];r++){var i=new FileReader;i.onload=function(){return function(e){var t=e.target.result,a=t.split("\n"),r=[],i="";if("#EXTM3U"==$.trim(a[0]))for(var s=1;s<a.length;s+=2)r=a[s].split(","),i=i+$.trim(r[1])+"\n",i=i.replace("(DatPiff Exclusive)",""),$("#query").val(i);else $("#query").val(t)}}(a),i.readAsText(a)}else alert("Failed to load files")}function getParameterByName(e){e=e.replace(/[\[]/,"\\[").replace(/[\]]/,"\\]");var t=new RegExp("[\\?&]"+e+"=([^&#]*)"),a=t.exec(location.search);return null===a?"":decodeURIComponent(a[1].replace(/\+/g," "))}function parseXml(e){$("#query").val("");var t,a=!1,r=!1;$.each(e.responseData.feed.entries,function(e,i){if(rssfeed.indexOf("digitaldripped")>=0)t=i.link.substr(i.link.lastIndexOf("/")+1),t=t.replace(/[-]/g," "),t=t.substring(0,t.indexOf("."));else if(rssfeed.indexOf("hotnewhiphop")>=0)i.title.indexOf("- ")>=0||i.title.indexOf("Video")>=0?(t=i.title,t=t.replace("Video","")):t="";else if(rssfeed.indexOf("rapradar")>=0)t=i.title,t=i.title.replace(/New Video: |New Music: |New LP: |New Mixtape: /g,"");else if(rssfeed.indexOf("allhiphop")>=0)i.title.indexOf("“")>=0?(t=i.title,t=i.title.replace(/“|”|\[VIDEO\] |PREMIERE: |FRESH HEAT |HEATER OF THE DAY: /g,"")):t="";else if(rssfeed.indexOf("nah_right")>=0)t=i.title.replace(/Video: |Audio:/g,"");else if(rssfeed.indexOf("SouthernSweetTea")>=0)t=i.title.replace(/Video: |Audio: |Mixtape: |EP: /g,""),t=$.trim(t);else if(rssfeed.indexOf("worldstar")>=0)i.title.indexOf("- ")>=0||i.title.indexOf("Video")>=0?(t=i.title,t=$("<textarea/>").html(t).text(),t=t.replace("Video",""),r=!0):t="";else if(rssfeed.indexOf("stereogum")>=0)t=i.title.replace(/“|”/g,""),r=!0;else if(rssfeed.indexOf("AlbumOfTheYear")>=0)t=i.title,t=i.title.replace(/New Track: |Video: |Video: |Listen: |First Listen: /g,""),t=$("<textarea/>").html(t).text();else if(rssfeed.indexOf("metacritic")>=0)t=i.title,t=$("<textarea/>").html(t).text();else if(rssfeed.indexOf("tinymixtapes")>=0){a=!0,r=!0,t=i.content;var s=t.split("\n"),l=[];$.each(s,function(e,a){a.indexOf("- ")>=0?l.push(a.replace(/<br>/g,"").replace(/<p>/g,"").replace(/<\/p>/g,"\n")):t=""}),t=l.join("\n")}else rssfeed.indexOf("billboard.com")>=0?(t=i.content.replace(/ranks /g,""),t=t.replace("by","-"),t=t.substring(0,t.indexOf("#"))):t=i.title;t&&(console.log(t),$("#query").val($("#query").val()+t+"\r"))}),a&&($("input#removenums").prop("checked",!0),removeNumbas()),r&&($("input#removeparenths").prop("checked",!0),removeParentheticals())}function loadRSS(e){if(rssfeed=e,rssfeed){if($.ajax({type:"GET",url:"https://ajax.googleapis.com/ajax/services/feed/load?v=1.0&num=100&output=json&q="+rssfeed,crossDomain:!0,dataType:"jsonp",success:parseXml}),history.pushState){var t=window.location.protocol+"//"+window.location.host+window.location.pathname+"?rss="+rssfeed;window.history.pushState({path:t},"",t)}$("#rss-dropdown").val(rssfeed)}}function findReplace(){var e=$("#find").val();e=new RegExp(e,"gi");var t=$("#replace").val(),a=$("#query2").val().split("\n"),r=[];$.each(a,function(a,i){r.push(i.replace(e,t))});var i=r.join("\n");$("#query").val(i),$("#query2").val($("#query").val())}$(document).ready(function(){rssfeed=getParameterByName("rss"),rssfeed&&loadRSS(rssfeed),$("#query2").val($("#query").val()),prevtext_state=$("#query").val()}),$("#advanced").click(function(){$("#advanced-container").slideToggle("fast"),editTextList()}),$("#pb-button").click(function(e){"0px"==$("#pb-menu").css("left")?pastBlasts.hide():(pastBlasts.display(),e.stopPropagation())}),$(".infolink").click(function(e){infoBlast.display(),e.stopPropagation()}),$("#rss-dropdown").change(function(){loadRSS($(this).val())}),$("#rss-button").click(function(){loadRSS($("#rss-dropdown").find(":selected").val())}),$("#addartist").focusout(function(){$("#query2").val($("#query").val())});var newartist=$("#addartist");$("#addartist").keyup(function(){addArtist()}),$("#addartist_button").click(function(){var e=result.val().split("\n"),t="";$.each(e,function(e,a){t+=newartist.val()+" "+a+"\n"})}),$("#frbutton").click(function(){findReplace()}),$("#removenums").click(function(){removeNumbas()}),$("#removeparenths").click(function(){removeParentheticals()}),$("#magic").click(function(){magicSongExtractor()}),$("#query").bind("paste",function(){var e=$(this);setTimeout(function(){var t=e.val();$("#query2").val(t),prevtext_state=t,$("input#removenums").prop("checked",!0),removeNumbas(),$("input#removeparenths").prop("checked",!0),removeParentheticals(),console.log(t)},100)}),document.getElementById("fileinput").addEventListener("change",readMultipleFiles,!1);var add=function(){var e=0;return function(){return e+=1}}(),delay=function(){var e=0;return function(t,a){clearTimeout(e),e=setTimeout(t,a)}}();$(function(){function e(e){return e.split(/\n\s*/)}function t(t){return e(t).pop()}function a(){var e=document.getElementById("query");console.log(e.value.substr(0,e.selectionStart).split("\n").length)}$("#mixbuilder-artist, #mixbuilder-song, #mixbuilder-album, #query").autocomplete({source:function(e,r){var i="AIzaSyDlcHPnr5gJr1_pBSvVSRtFudfpIUppfjM",s=t(e.term);$.ajax({url:"https://suggestqueries.google.com/complete/search?hl=en&ds=yt&client=youtube&hjson=t&cp=1&q="+s+"&key="+i+"&format=5&alt=json&callback=?",dataType:"jsonp",success:function(e){r($.map(e[1],function(e){return{label:e[0],value:e[0]}}))}}),a()},search:function(){var e=t(this.value);return e.length<2?!1:void 0},focus:function(t,a){var r=e(this.value);return r.pop(),r.push(a.item.value),this.value=r.join("\n"),r.pop(),!1},select:function(t,a){var r=e(this.value);r.pop(),r.push(a.item.value),r.push(""),this.value=r.join("\n");for(var i=t;i&&(13==i.keyCode&&i.stopPropagation(),i!=t.originalEvent);)i=t.originalEvent;return!1},appendTo:"#mixbuilder-bar"})});
function createPlaylist(){var e=gapi.client.youtube.playlists.insert({part:"snippet,status",resource:{snippet:{title:$("#playlist-title").val(),description:"Playlist created with Mixblast - http://mixbla.st \n"},status:{privacyStatus:"public"}}});e.execute(function(e){var t=e.result;console.log(t),t?(playlistId=t.id,$("#playlist-id").val(playlistId),$("#playlist-url-copy").val("http://youtube.com/playlist?list="+playlistId),$("#playlist-url").append('<a href="http://youtube.com/playlist?list='+playlistId+'" target="_blank">Click here to to view your playlist</a><br><br>'),$("#playlist-url").append('<a href="https://www.facebook.com/sharer/sharer.php?u='+encodeURIComponent("http://youtube.com/playlist?list="+playlistId)+'&p[images][0]=http://mixbla.st/img/mixblast-logo8.png" target="_blank">Blast your mix to Facebook</a><br><br>'),$("#playlist-title").val(t.snippet.title),multiAddVideosToPlaylist()):alert("Uh oh. Could not create playlist. Make sure you're signed in to Youtube. It should say (200 video limit) instead of (Sign in).\n\nIf you are logged in, try logging out of youtube.com, then refresh mixblast, then sign in again. Sorry 'bout that.\n\nMake sure your youtube account has a \"youtube channel.\" You can do this by creating at least one playlist on youtube.com. ")}),$("#playlist-url").show()}function multiAddVideosToPlaylist(){var e=0,t=search.topvIdArray.length+1;t>199&&(t=199);var a=setInterval(function(){$("#playlist-status").html("Generating YouTube Playlist... (Don't leave this page) "+e+" of "+search.topvIdArray.length),addToPlaylist(search.topvIdArray[e]),e++,e==t&&(clearInterval(a),$("#playlist-status").html("Done!"))},200);setTimeout(function(){window.scrollTo(0,document.body.scrollHeight)},700)}function addVideoToPlaylist(){addToPlaylist($("#video-id").val())}function addToPlaylist(e,t,a){var r={videoId:e,kind:"youtube#video"};void 0!=t&&(r.startAt=t),void 0!=a&&(r.endAt=a);var i=gapi.client.youtube.playlistItems.insert({part:"snippet",resource:{snippet:{playlistId:playlistId,resourceId:r}}});i.execute(function(e){$("#status").html("<pre>"+JSON.stringify(e.result)+"</pre>")})}var playlistId,channelId;
